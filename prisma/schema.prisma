generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model AuditLog {
  id           String     @id
  universityId String
  userId       String
  userName     String
  action       String
  entity       String
  entityId     String?
  details      String?
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime   @default(now())
  University   University @relation(fields: [universityId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([action])
  @@index([userId])
  @@index([universityId])
}

model CsvConfig {
  id           String     @id
  universityId String
  templateId   String     @unique
  name         String
  fields       String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Template     Template   @relation(fields: [templateId], references: [id], onDelete: Cascade)
  University   University @relation(fields: [universityId], references: [id], onDelete: Cascade)

  @@index([universityId])
}

model Document {
  id           String     @id
  universityId String
  studentId    String
  templateId   String
  title        String
  pdfUrl       String?
  jpegUrl      String?
  qrHash       String?    @unique
  qrUrl        String?
  metadata     String?
  isPublished  Boolean    @default(false)
  publishedAt  DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Template     Template   @relation(fields: [templateId], references: [id], onDelete: Cascade)
  Student      Student    @relation(fields: [studentId], references: [id], onDelete: Cascade)
  University   University @relation(fields: [universityId], references: [id], onDelete: Cascade)

  @@index([qrHash])
  @@index([templateId])
  @@index([studentId])
  @@index([universityId])
}

model FileUpload {
  id           String   @id
  universityId String?
  fileName     String
  originalName String
  fileType     String
  fileSize     Int
  fileUrl      String
  folder       String   @default("uploads")
  createdAt    DateTime @default(now())

  @@index([folder])
  @@index([universityId])
}

model Student {
  id           String     @id
  universityId String
  rollNo       String
  regNo        String?
  name         String
  fatherName   String?
  motherName   String?
  dob          DateTime?
  email        String?
  mobile       String?
  customData   String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Document     Document[]
  University   University @relation(fields: [universityId], references: [id], onDelete: Cascade)

  @@unique([universityId, rollNo])
  @@index([mobile])
  @@index([regNo])
  @@index([rollNo])
  @@index([universityId])
}

model SuperAdmin {
  id        String   @id
  email     String   @unique
  password  String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model Template {
  id            String     @id
  universityId  String
  name          String
  type          String
  description   String?
  htmlContent   String?
  htmlConfig    String?
  backgroundUrl String?
  mappingConfig String?
  zipUrl        String?
  fileMapping   String?
  qrEnabled     Boolean    @default(true)
  qrPosition    String?
  isActive      Boolean    @default(true)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime
  CsvConfig     CsvConfig?
  Document      Document[]
  University    University @relation(fields: [universityId], references: [id], onDelete: Cascade)

  @@index([type])
  @@index([universityId])
}

model University {
  id              String            @id
  name            String
  subdomain       String            @unique
  slug            String            @unique
  logo            String?
  primaryColor    String            @default("#3b82f6")
  secondaryColor  String            @default("#1e40af")
  headerImage     String?
  footerImage     String?
  stampImage      String?
  signatureImage  String?
  watermark       String?
  qrEnabled       Boolean           @default(true)
  seoTitle        String?
  seoDescription  String?
  seoKeywords     String?
  seoOgImage      String?
  seoJsonLd       String?
  landingPageData String?
  isActive        Boolean           @default(true)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  AuditLog        AuditLog[]
  CsvConfig       CsvConfig[]
  Document        Document[]
  Student         Student[]
  Template        Template[]
  UniversityAdmin UniversityAdmin[]

  @@index([slug])
  @@index([subdomain])
}

model UniversityAdmin {
  id           String     @id
  email        String     @unique
  password     String
  name         String
  role         String     @default("admin")
  universityId String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  University   University @relation(fields: [universityId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([universityId])
}
